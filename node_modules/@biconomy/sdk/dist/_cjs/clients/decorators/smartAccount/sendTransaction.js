"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.sendTransaction = sendTransaction;
const account_abstraction_1 = require("viem/account-abstraction");
const utils_1 = require("viem/utils");
const AccountNotFound_1 = require("../../../account/utils/AccountNotFound.js");
const Helpers_1 = require("../../../account/utils/Helpers.js");
const Logger_1 = require("../../../account/utils/Logger.js");
async function sendTransaction(client, args, signature) {
    let userOpHash;
    if ("to" in args) {
        const { account: account_ = client.account, data, maxFeePerGas, maxPriorityFeePerGas, to, value, nonce } = args;
        if (!account_) {
            throw new AccountNotFound_1.AccountNotFoundError({
                docsPath: "/nexus/nexus-client/methods#sendtransaction"
            });
        }
        const account = (0, utils_1.parseAccount)(account_);
        if (!to)
            throw new Error("Missing to address");
        const sendUserOperationArgs = {
            calls: [
                {
                    to,
                    value: value || BigInt(0),
                    data: data || "0x"
                }
            ],
            account,
            maxFeePerGas,
            maxPriorityFeePerGas,
            signature,
            nonce: nonce ? BigInt(nonce) : undefined
        };
        const { account: _, ...logableArgs } = sendUserOperationArgs;
        Logger_1.Logger.log(JSON.stringify(logableArgs, Helpers_1.bigIntReplacer, 2));
        userOpHash = await (0, utils_1.getAction)(client, account_abstraction_1.sendUserOperation, "sendUserOperation")(sendUserOperationArgs);
    }
    else {
        userOpHash = await (0, utils_1.getAction)(client, account_abstraction_1.sendUserOperation, "sendUserOperation")({ ...args, signature });
    }
    const userOperationReceipt = await (0, utils_1.getAction)(client, account_abstraction_1.waitForUserOperationReceipt, "waitForUserOperationReceipt")({
        hash: userOpHash
    });
    return userOperationReceipt?.receipt.transactionHash;
}
//# sourceMappingURL=sendTransaction.js.map